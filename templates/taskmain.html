<!--Ìà¨ÎëêÎ¶¨Ïä§Ìä∏ Î≥∏ ÌéòÏù¥ÏßÄ: Îã¨Î†• ÏûàÍ≥†, Ìï† Ïùº Îú®Îäî ÌéòÏù¥ÏßÄ-->
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ìà¨ÎëêÎ¶¨Ïä§Ìä∏</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>tailwind.config = { theme: { extend: { colors: { primary: '#4ade80', secondary: '#a3e635' }, borderRadius: { 'none': '0px', 'sm': '4px', DEFAULT: '8px', 'md': '12px', 'lg': '16px', 'xl': '20px', '2xl': '24px', '3xl': '32px', 'full': '9999px', 'button': '8px' } } } }</script>
  <!--ÎîîÏûêÏù∏ÏùÑ ÏúÑÌïú ÏΩîÎìú: ÏÇ≠Ï†úÌïòÎ©¥ ÏïàÎê®-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <!--‚úÖÏïÑÏù¥ÏΩò-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
</head>

<body class="h-full w-full min-h-screen min-w-full">
  <div class="flex min-h-screen h-full w-full">
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <div class="w-64 border-r border-gray-200 bg-white">
      <div class="p-4 border-b border-gray-200 flex items-center">
        <div class="font-['Pacifico'] text-primary text-xl">logo</div>
        <div class="w-8 h-8 flex items-center justify-center ml-auto">
          <i class="ri-menu-line text-gray-500"></i>
        </div>
      </div>
      <div class="p-4">
        <h2 class="text-sm font-medium text-gray-500 mb-2">Ïπ¥ÌÖåÍ≥†Î¶¨</h2>
        <div class="space-y-1">
          <!-- ÎßàÏùå Ïπ¥ÌÖåÍ≥†Î¶¨ -->
          <div class="category-item flex items-center px-3 py-2 rounded bg-green-50">
            <div class="w-6 h-6 flex items-center justify-center mr-2 text-green-500">
              <i class="ri-heart-line"></i>
            </div>
            <span class="text-green-600 font-medium">ÎßàÏùå</span>
            <div class="category-actions opacity-0 flex ml-auto">
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="ri-edit-line"></i>
              </button>
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </div>
          <!-- Í≥µÎ∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ -->
          <div class="category-item flex items-center px-3 py-2 rounded hover:bg-gray-50">
            <div class="w-6 h-6 flex items-center justify-center mr-2 text-blue-500">
              <i class="ri-book-open-line"></i>
            </div>
            <span>Í≥µÎ∂Ä</span>
            <div class="category-actions opacity-0 flex ml-auto">
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="ri-edit-line"></i>
              </button>
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </div>

          <!-- ÌåÄÌîå Ïπ¥ÌÖåÍ≥†Î¶¨ -->
          <div class="category-item flex items-center px-3 py-2 rounded hover:bg-gray-50">
            <div class="w-6 h-6 flex items-center justify-center mr-2 text-indigo-500">
              <i class="ri-team-line"></i>
            </div>
            <span>ÌåÄÌîå</span>
            <div class="category-actions opacity-0 flex ml-auto">
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="ri-edit-line"></i>
              </button>
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </div>
          <!-- Ïö¥Îèô Ïπ¥ÌÖåÍ≥†Î¶¨ -->
          <div class="category-item flex items-center px-3 py-2 rounded hover:bg-gray-50">
            <div class="w-6 h-6 flex items-center justify-center mr-2 text-orange-500">
              <i class="ri-run-line"></i>
            </div>
            <span>Ïö¥Îèô</span>
            <div class="category-actions opacity-0 flex ml-auto">
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="ri-edit-line"></i>
              </button>
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </div>
          <!-- ÎèÖÏÑú Ïπ¥ÌÖåÍ≥†Î¶¨ -->
          <div class="category-item flex items-center px-3 py-2 rounded hover:bg-gray-50">
            <div class="w-6 h-6 flex items-center justify-center mr-2 text-purple-500">
              <i class="ri-book-read-line"></i>
            </div>
            <span>ÎèÖÏÑú</span>
            <div class="category-actions opacity-0 flex ml-auto">
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="ri-edit-line"></i>
              </button>
              <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </div>
        </div>
        <button class="mt-4 flex items-center text-sm text-gray-600 hover:text-gray-900">
          <div class="w-5 h-5 flex items-center justify-center mr-1">
            <i class="ri-add-line"></i>
          </div>
          <span>Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä</span>
        </button>
      </div>
    </div>

    <!--Î©îÏù∏ÏΩòÌÖêÏ∏†-->
    <div class="flex-1 flex flex-col min-h-0 h-full p-6">
      <div class="border-b border-gray-200 pb-4 mb-6">
        <h1 class="text-xl font-semibold">Ìà¨ÎëêÎ¶¨Ïä§Ìä∏</h1>
      </div>
      <div class="flex items-center mb-6">
        <!--**Ïò§ÎäòÏùò ÎÇ†Ïßú + ÎÇ®ÏùÄ Ìï† Ïùº Î™©Î°ù**-->
        <h2 class="text-lg font-medium text-gray-900" id="top-today-todo-date">5/21 Ïò§ÎäòÏùò todo</h2>
        <span class="ml-2 text-sm text-gray-500" id="today-listnum">13Í∞úÏùò Ìï≠Î™©</span>
      </div>

      <!--Ïù¥ ÏΩîÎìúÍ∞Ä Ï∫òÎ¶∞ÎçîÎûë ÏùºÏùº Ìà¨Îëê ÎÇòÎûÄÌûà ÎùÑÏõåÏ£ºÍ≥† ÏûàÏúºÎãà ÏÇ≠Ï†úÌïòÎ©¥ ÏïàÎèºÏöî!-->
      <div class="flex-1 min-h-0 flex flex-col">
        <div class="grid grid-cols-2 gap-6 h-full min-h-0 flex-1">
          <!-- Ï∫òÎ¶∞Îçî -->
          <div class="h-full flex flex-col min-h-0">
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm flex-1 flex flex-col min-h-0">
              <!--Ï∫òÎ¶∞Îçî ÏÉÅÎã®Î∂ÄÎ∂Ñ-->
              <div class="flex justify-between items-center mb-4">
                <h3 class="font-medium" id="calendertop-date">5Ïõî 2025</h3>
                <div class="flex">
                  <button
                    class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-900 !rounded-button"
                    id="lastmonth-button">
                    <i class="ri-arrow-left-s-line"></i>
                  </button>
                  <button
                    class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-900 !rounded-button"
                    id="nextmonth-button">
                    <i class="ri-arrow-right-s-line"></i>
                  </button>
                </div>
              </div>

              <div class="grid grid-cols-7 gap-1 mb-2">
                <div class="text-center text-sm font-medium text-gray-600">SUN</div>
                <div class="text-center text-sm font-medium text-gray-600">MON</div>
                <div class="text-center text-sm font-medium text-gray-600">TUE</div>
                <div class="text-center text-sm font-medium text-gray-600">WED</div>
                <div class="text-center text-sm font-medium text-gray-600">THU</div>
                <div class="text-center text-sm font-medium text-gray-600">FRI</div>
                <div class="text-center text-sm font-medium text-gray-600">SAT</div>
              </div>

              <!--Ï∫òÎ¶∞Îçî: Í∑∏Î¶¨Îìú Ïª®ÌÖåÏù¥ÎÑàÎ°ú Ïó¥7Í∞ú, gapÏùÄ1Ïî© Ï£ºÍ≤åÎêòÏñ¥ÏûàÎäî ÎîîÏûêÏù∏ÏûÖÎãàÎã§. 7ÏùÄ Í±¥Îì§ÏßÄ ÎßêÍ≥†, Í∞ÑÍ≤© ÎùÑÏö∞Í≥† Ïã∂ÏúºÎ©¥ 1Îßå ÏõÄÏßÅÏù¥ÏÑ∏Ïöî-->
              <div class="grid grid-cols-7 gap-1 flex-1 min-h-0" id="Îã¨Î†•"></div>
            </div>
          </div>

          <div class="h-full flex flex-col min-h-0">
            <!-- ÏùºÏùº Ìà¨Îëê -->
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm flex-1 flex flex-col min-h-0">

              <div class="flex justify-between items-center mb-4">
                <h3 class="font-medium" id="today-todo-date">5/20</h3>
                <!--üî¥ Ìà¨Îç∞Ïù¥ Ìï† Ïùº Ìï≠Î™© Í∞úÏàò: Ïù¥Í±∞ ÏïÑÎßà ÎèôÏ†ÅÏúºÎ°ú Î∞îÍøîÏïºÌï† Í≤É Í∞ôÏäµÎãàÎã§. Î¨¥Î¶¨Î©¥ Í∑∏ÎÉ• ÎπºÍ≥†Ïöî-->
                <span class="text-xs text-gray-500">10Í∞úÏùò Ìï≠Î™©</span>
              </div>

              <!--Ìà¨ÎëêÎ¶¨Ïä§Ìä∏ ÎèôÏ†ÅÏúºÎ°ú Íµ¨ÌòÑÌïòÎäî Í≤É ÌïÑÏöî + DB/ÌååÏùº Îì±Îì±..Ï®ãÎì† Ï†ïÎ≥¥ Ï†ÄÏû•ÌïòÎäî Î∞©Î≤ï Íµ¨ÌòÑ ÌïÑÏöî-->
              <!-- ÎßàÏùå Ïπ¥ÌÖåÍ≥†Î¶¨ -->
              <div class="mb-5" id="todoarea">
                <div class="todolist-card" id="todo-card"></div>
              </div>
              <button class="text-sm text-gray-500 hover:text-primary flex items-center" id="addtodo">
                <div class="w-4 h-4 flex items-center justify-center mr-1">
                  <i class="ri-add-line"></i>
                </div>
                Ï∂îÍ∞ÄÌïòÍ∏∞
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const today = new Date();
    let defaultmonth = today.getMonth() + 1;
    let defaultyear = today.getFullYear();
    let selectedMonth = defaultmonth;
    let selectedDay = today.getDate();

    document.addEventListener('DOMContentLoaded', function () {
      renderCalender(defaultyear, defaultmonth);
      loadtodolist(selectedMonth, selectedDay);
    });

    document.getElementById('lastmonth-button').addEventListener('click', function () {
      defaultmonth--;
      if (defaultmonth < 1) {
        defaultmonth = 12;
        defaultyear--;
      }
      renderCalender(defaultyear, defaultmonth);
    });

    document.getElementById('nextmonth-button').addEventListener('click', function () {
      defaultmonth++;
      if (defaultmonth > 12) {
        defaultmonth = 1;
        defaultyear++;
      }
      renderCalender(defaultyear, defaultmonth);
    });

    function renderCalender(year, month) {
      const calendersection = document.getElementById('Îã¨Î†•');
      calendersection.innerHTML = '';

      const editCalenderTop = document.getElementById('calendertop-date');
      editCalenderTop.textContent = `${month}Ïõî ${year}`;

      const firstDay = new Date(year, month - 1, 1);
      const lastDay = new Date(year, month, 0);
      const firstWeekDay = firstDay.getDay();
      const lastMonthLastDay = new Date(year, month - 1, 0).getDate();

      for (let i = firstWeekDay - 1; i >= 0; i--) {
        const dayDiv = document.createElement('div');
        dayDiv.className = "flex justify-center";
        dayDiv.innerHTML = `<div class="day text-gray-400">${lastMonthLastDay - i}</div>`;
        calendersection.appendChild(dayDiv);
      }

      for (let d = 1; d <= lastDay.getDate(); d++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = "flex justify-center";
        dayDiv.innerHTML = `<div class="day bg-white">${d}</div>`;
        calendersection.appendChild(dayDiv);
      }

      document.getElementById('Îã¨Î†•').addEventListener('click', function (e) {
        if (e.target.classList.contains('day')) {
          document.querySelector('.day.active')?.classList.remove('active', 'bg-primary', 'text-white');
          e.target.classList.add('active', 'bg-primary', 'text-white');

          selectedMonth = defaultmonth;
          selectedDay = parseInt(e.target.textContent);

          document.getElementById('today-todo-date').textContent = `${selectedMonth}/${selectedDay}`;
          document.getElementById('top-today-todo-date').textContent = `${selectedMonth}/${selectedDay} Ïò§ÎäòÏùò todo`;

          loadtodolist(selectedMonth, selectedDay);
        }
      });
    }

    async function loadtodolist(month, day) {
      const res = await fetch(`api/todolist?month=${month}&day=${day}`);
      const todos = await res.json();

      const todoArea = document.getElementById("todoarea");
      todoArea.innerHTML = '';

      const Area = document.createElement('div');
      Area.className = "mb-2";

      const ul = document.createElement('ul');
      ul.className = "space-y-2";

      todos.forEach(item => {
        const li = createTodoElement(item.id, item.todo, item.state);
        ul.appendChild(li);
      });

      Area.appendChild(ul);
      todoArea.appendChild(Area);
    }

    function createTodoElement(id, todoText, state) {
      const li = document.createElement('li');
      li.className = "task-item flex items-center justify-between";
      li.innerHTML = `
      <div class="flex items-center">
        <input type="checkbox" class="custom-checkbox" data-id="${id}" ${state ? 'checked' : ''}>
        <span class="ml-2 text-base${state ? ' line-through text-gray-500' : ''}" id="todolist-context">${todoText}</span>
      </div>
      <div class="task-actions flex">
        <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 edit-btn" data-id="${id}">
          <i class="ri-edit-line"></i>
        </button>
        <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500 delete-btn" data-id="${id}">
          <i class="ri-delete-bin-line"></i>
        </button>
      </div>`;

      const taskText = li.querySelector('#todolist-context');
      const checkbox = li.querySelector('.custom-checkbox');
      const editBtn = li.querySelector('.edit-btn');
      const deleteBtn = li.querySelector('.delete-btn');

      checkbox.addEventListener('change', function () {
        const id = this.dataset.id;
        const checked = this.checked;
        if (checked) {
          taskText.classList.add('line-through', 'text-gray-500');
        } else {
          taskText.classList.remove('line-through', 'text-gray-500');
        }
        fetch('/checkbox', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: id, state: checked })
        });
      });

      editBtn.addEventListener('click', function () {
        taskText.setAttribute('contenteditable', 'true');
        taskText.focus();
        taskText.addEventListener('keydown', (e) => {
          if (e.key == 'Enter') {
            e.preventDefault();
            taskText.blur();
          }
        });
        taskText.addEventListener('blur', () => {
          taskText.setAttribute('contenteditable', 'false');
          const updatedText = taskText.textContent.trim();
          fetch('/edit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: id, todo: updatedText })
          });
        }, { once: true });
      });

      deleteBtn.addEventListener('click', function () {
        fetch('/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: id })
        }).then(() => li.remove());
      });

      return li;
    }

    document.getElementById('addtodo').addEventListener('click', function () {
      const todoText = "ÏÉàÎ°úÏö¥ Ìï† Ïùº";
      const state = false;

      fetch('/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          todo: todoText,
          month: selectedMonth,
          day: selectedDay
        })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            const li = createTodoElement(data.id, todoText, state);
            const todoArea = document.getElementById("todoarea");
            const ul = todoArea.querySelector('ul') || document.createElement('ul');
            ul.className = "space-y-2";
            ul.appendChild(li);
            if (!todoArea.querySelector('ul')) {
              const wrapDiv = document.createElement('div');
              wrapDiv.className = "mb-2";
              wrapDiv.appendChild(ul);
              todoArea.appendChild(wrapDiv);
            }
          } else {
            alert('Ìï† Ïùº Ï∂îÍ∞Ä Ïã§Ìå®');
          }
        });
    });
  </script>

</body>

</html>